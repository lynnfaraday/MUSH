@create FS3 Skill Tests
@set FS3 Skill Tests = WIZARD
@set FS3 Skill Tests = SAFE
@set FS3 Skill Tests=!NO_COMMAND
&CMD-+TEST FS3 Skill Tests=$+fs3skilltest:@dolist lattr(me/test*)=@pemit %#=[switch(u(##),1,ansi(hg,PASS),ansi(hr,FAIL))] [after(##,_)]
&DB FS3 Skill Tests=install_aliasdb(FS3SKILL_FUN)
@STARTUP FS3 Skill Tests=@set me=!no_command
@set FS3 Skill Tests/STARTUP=no_command prefixmatch
&AN_ATTRIBUTE FS3 Skill Tests=Mind
&FIREARMS_RULING_ATTR FS3 Skill Tests=Reaction
&FIREARMS_SKILL FS3 Skill Tests=Firearms
&ANOTHER_SKILL FS3 Skill Tests=Medicine
&TEST_ABILITY_LEVEL_ATTRIBUTE FS3 Skill Tests=[set(%#,attributes:[v([v(firearms_skill)]_ruling_attr)]:3)][eq(u([u(db)]/fun_ability_level,%#,[v([v(firearms_skill)]_ruling_attr)]),3)]
&TEST_ABILITY_LEVEL_NUMBER FS3 Skill Tests=[eq(u([u(db)]/fun_ability_level,%#,4),4)]
&TEST_ABILITY_LEVEL_DEFAULT_NPC_LEVEL FS3 Skill Tests=[eq(u([u(db)]/fun_ability_level,#-1,[v(firearms_skill)]),2)]
&TEST_ABILITY_LEVEL_ACTIONSKILL FS3 Skill Tests=[set(%#,actionskills:[v(firearms_skill)]:5)][eq(u([u(db)]/fun_ability_level,%#,[v(firearms_skill)]),5)]
&TEST_ABILITY_LEVEL_BGSKILL FS3 Skill Tests=[set(%#,bgskills:Basketweaving:3)][eq(u([u(db)]/fun_ability_level,%#,Basketweaving),3)]
&TEST_ABILITY_LEVEL_NPC_EXISTS FS3 Skill Tests=u([u(db)]/fun_is_npc,TestNPC)
&TEST_ABILITY_LEVEL_NPC_NUMBER FS3 Skill Tests=[eq(u([u(db)]/fun_ability_level,TestNPC,9),9)]
&TEST_ABILITY_LEVEL_NPC_SKILL FS3 Skill Tests=[eq(u([u(db)]/fun_ability_level,TestNPC,Melee),3)]
&TEST_COUNT_SUCCESSES_ZERO_HITS FS3 Skill Tests=[eq(fold([u(db)]/fun_count_successes,1 2 3,0),0)]
&TEST_COUNT_SUCCESSES_TWO_HITS FS3 Skill Tests=[eq(fold([u(db)]/fun_count_successes,7 8 1 3,0),2)]
&TEST_LEVEL_BRACKET_ATTRIBUTES FS3 Skill Tests=strmatch(Poor Average Good Exceptional,iter(lnum(1,4),u([u(db)]/fun_level_bracket,##,attribute))
&TEST_LEVEL_BRACKET_SKILLS FS3 Skill Tests=strmatch(Novice Novice Novice Proficient Proficient Proficient Veteran Veteran Veteran Master Master Master,iter(lnum(1,12),u([u(db)]/fun_level_bracket,##,skill))
&TEST_LEVEL_BRACKET_ABBREV_SKILLS FS3 Skill Tests=strmatch(Nov Nov Nov Pro Pro Pro Vet Vet Vet Mas Mas Mas,iter(lnum(1,12),u([u(db)]/fun_level_bracket_abbrev,##,skill))
&TEST_LEVEL_BRACKET_ABBREV_ATTRIBUTES FS3 Skill Tests=strmatch(Poor Avg Good Exc,iter(lnum(1,4),u([u(db)]/fun_level_bracket_abbrev,##,attribute))
&TEST_OPPOSED_RESULT_ALL_VALUES FS3 Skill Tests=strmatch(F D A|M A|V A|C B|M B|V B|C,iter(0|0 1|1 2|1 2|0 4|0 1|2 0|2 1|5,u([u(db)]/fun_get_opposed_result,before(##,|),after(##,|))))
&TEST_PARSE_ROLL_PARAMS_SKILL FS3 Skill Tests=strmatch(u([u(db)]/fun_parse_roll_params,A B),A_B||0)
&TEST_PARSE_ROLL_PARAMS_SKILL_ATTR FS3 Skill Tests=strmatch(u([u(db)]/fun_parse_roll_params,A B,+[v(an_attribute)]),A_B|[v(an_attribute)]|0)
&TEST_PARSE_ROLL_PARAMS_SKILL_ATTR_MOD FS3 Skill Tests=strmatch(u([u(db)]/fun_parse_roll_params,A B,+[v(an_attribute)],+1),A_B|[v(an_attribute)]|1)
&TEST_PARSE_ROLL_PARAMS_SKILL_ATTR_NEGMOD FS3 Skill Tests=strmatch(u([u(db)]/fun_parse_roll_params,A B,+[v(an_attribute)],-1),A_B|[v(an_attribute)]|-1)
&TEST_PARSE_ROLL_PARAMS_ATTR_SKILL_NEGMOD FS3 Skill Tests=strmatch(u([u(db)]/fun_parse_roll_params,[v(an_attribute)],A B,-1),A_B|[v(an_attribute)]|-1)
&TEST_PARSE_ROLL_PARAMS_ATTR_NEGMOD FS3 Skill Tests=strmatch(u([u(db)]/fun_parse_roll_params,[v(an_attribute)],-1),0|[v(an_attribute)]|-1)
&TEST_PARSE_ROLL_PARAMS_NUMBER_MOD FS3 Skill Tests=strmatch(u([u(db)]/fun_parse_roll_params,2,-1),2||-1)
&TEST_PARSE_ROLL_PARAMS_MULTIPLE_ATTRS FS3 Skill Tests=strmatch(u([u(db)]/fun_parse_roll_params,[v(an_attribute)],[v(an_attribute)],[v(an_attribute)]),[v(an_attribute)]|[v(an_attribute)]|0)
&TEST_PRETTY_OPPOSED_RESULT FS3 Skill Tests=strmatch(DRAW Both Fail. A wins - Marginal Victory A wins - Solid Victory A wins - Crushing Victory B wins - Marginal Victory B wins - Solid Victory B wins - Crushing Victory,stripansi(iter(D F A|M A|V A|C B|M B|V B|C,u([u(db)]/fun_pretty_opposed_result,A,B,##))))
&TEST_ROLL_RESULT_SUCCESS FS3 Skill Tests=eq(2,u([u(db)]/fun_roll_result,1 8 8 4 5,2))
&TEST_ROLL_RESULT_FAILURE FS3 Skill Tests=eq(0,u([u(db)]/fun_roll_result,1 5 6 4 5,2))
&TEST_ROLL_RESULT_EMBARASSING FS3 Skill Tests=eq(-1,u([u(db)]/fun_roll_result,1 1 6 4 5,2))
&TEST_RULING_ATTR_ACTIONSKILL FS3 Skill Tests=match(u([u(db)]/fun_ruling_attr,%#,[v(firearms_skill)]),[v([v(firearms_skill)]_ruling_attr)])
&TEST_RULING_ATTR_ATTR FS3 Skill Tests=eq(u([u(db)]/fun_ruling_attr,%#,Technical),0)
&TEST_RULING_ATTR_BGSKILL FS3 Skill Tests=match(u([u(db)]/fun_ruling_attr,%#,NemoSkill),[v(an_attribute)])
&TEST_RULING_ATTR_BGSKILL_WITH_OVERRIDE FS3 Skill Tests=[set(%#,bgskills:Basketweaving:3)][set(%#,ruling_attr:Basketweaving:Creative)]match(u([u(db)]/fun_ruling_attr,%#,Basketweaving),Creative)
&TEST_RULING_ATTR_MOD_NORMAL FS3 Skill Tests=[set(%#,attributes:[v([v(firearms_skill)]_ruling_attr)]:3)][eq(u([u(db)]/fun_ruling_attr_mod,%#,[v(firearms_skill)]),3)]
&TEST_RULING_ATTR_MOD_WITH_OVERRIDE FS3 Skill Tests=[set(%#,attributes:[v([v(firearms_skill)]_ruling_attr)]:3)][eq(u([u(db)]/fun_ruling_attr_mod,%#,[v(another_skill)],[v([v(firearms_skill)]_ruling_attr)]),3)]
&TEST_SET_ABILITY_ACTIONSKILL FS3 Skill Tests=[set(%#,actionskills:)][setq(0,[u([u(db)]/fun_set_ability,%#,action,[v(firearms_skill)],1)][u([u(db)]/fun_set_ability,%#,action,[v(firearms_skill)],2)][u([u(db)]/fun_set_ability,%#,action,[v(another_skill)],5)][u([u(db)]/fun_set_ability,%#,action,[v(firearms_skill)],-1)])][and(eq(%q0,1111),strmatch(xget(%#,actionskills),[v(firearms_skill)]:2 [v(another_skill)]:5))]
&TEST_SET_ABILITY_SKILL_TO_ZERO FS3 Skill Tests=[set(%#,actionskills:)][setq(0,[u([u(db)]/fun_set_ability,%#,action,[v(firearms_skill)],1)][u([u(db)]/fun_set_ability,%#,action,Melee,2)][u([u(db)]/fun_set_ability,%#,action,[v(firearms_skill)],-1)])][and(eq(%q0,111),strmatch(xget(%#,actionskills),Melee:2))]
&TEST_SET_ABILITY_ATTR FS3 Skill Tests=[set(%#,attributes:)][setq(0,[u([u(db)]/fun_set_ability,%#,attr,[v([v(firearms_skill)]_ruling_attr)],1)][u([u(db)]/fun_set_ability,%#,attr,[v([v(firearms_skill)]_ruling_attr)],2)][u([u(db)]/fun_set_ability,%#,attr,[v(an_attribute)],3)][u([u(db)]/fun_set_ability,%#,attr,[v([v(firearms_skill)]_ruling_attr)],-1)])][and(eq(%q0,1111),strmatch(xget(%#,attributes),[v([v(firearms_skill)]_ruling_attr)]:2 [v(an_attribute)]:3))]
&TEST_SET_ABILITY_FAIL_ATTR_ZERO FS3 Skill Tests=[set(%#,attributes:)][setq(0,u([u(db)]/fun_set_ability,%#,attr,[v([v(firearms_skill)]_ruling_attr)],0))][eq(0,before(%q0,|))][pemit(%#,%q0)]
&TEST_SET_ABILITY_FAIL_ATTR_TOO_HIGH FS3 Skill Tests=[set(%#,attributes:)][setq(0,u([u(db)]/fun_set_ability,%#,attr,[v([v(firearms_skill)]_ruling_attr)],5))][eq(0,before(%q0,|))][pemit(%#,%q0)]
&TEST_SET_ABILITY_FAIL_SKILL_TOO_HIGH FS3 Skill Tests=[set(%#,actionskills:)][setq(0,u([u(db)]/fun_set_ability,%#,act,[v(firearms_skill)],13))][eq(0,before(%q0,|))][pemit(%#,%q0)]
&TEST_SET_ABILITY_FAIL_SKILL_TOO_LOW FS3 Skill Tests=[set(%#,actionskills:)][setq(0,u([u(db)]/fun_set_ability,%#,act,[v(firearms_skill)],-1))][eq(0,before(%q0,|))][pemit(%#,%q0)]
&TEST_SET_ABILITY_FAIL_ACTSKILL_AS_BG FS3 Skill Tests=[set(%#,bgskills:)][setq(0,u([u(db)]/fun_set_ability,%#,bg,[v(firearms_skill)],2))][eq(0,before(%q0,|))][pemit(%#,%q0)]
&TEST_SET_ABILITY_FAIL_ATTR_AS_BG FS3 Skill Tests=[set(%#,bgskills:)][setq(0,u([u(db)]/fun_set_ability,%#,bg,[v(an_attribute)],2))][eq(0,before(%q0,|))][pemit(%#,%q0)]
&TEST_SUCCESS_LEVEL_ALL_VALUES FS3 Skill Tests=strmatch(Embarassing Failure Failure Success Good Success Good Success Great Success Great Success Amazing Success,[stripansi(iter(-1 [lnum(0,6)],u([u(db)]/fun_pretty_success_level,##)))])
